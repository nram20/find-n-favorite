'use strict';

angular.module('myApp', ['ui.router', 'satellizer', 'ngFileUpload']).config(["$authProvider", function ($authProvider) {

	$authProvider.loginUrl = '/api/users/login';
	$authProvider.signupUrl = '/api/users/signup';

	// configure satellizer by giving it the provider app ID
	// specify the url to make a post request to when the token is generated by satellizer
	$authProvider.facebook({
		clientId: '1153082801420831',
		url: '/api/users/facebook'
	});
}]).config(["$stateProvider", "$urlRouterProvider", function ($stateProvider, $urlRouterProvider) {
	$stateProvider.state('home', { url: '/', templateUrl: '/html/home.html' }).state('login', {
		url: '/login',
		templateUrl: '/html/login.html',
		controller: 'loginCtrl'
	}).state('register', {
		url: '/register',
		templateUrl: '/html/register.html',
		controller: 'registerCtrl'
	}).state('profile', {
		url: '/profile',
		templateUrl: '/html/profile.html',
		controller: 'profileCtrl',
		resolve: {
			Profile: ["User", function Profile(User) {
				return User.getProfile();
			}]
		}
	}).state('search', {
		url: '/search',
		templateUrl: '/html/search.html',
		controller: 'searchCtrl'
	}).state('businessShow', {
		url: '/businessShow/:yelpId',
		templateUrl: '/html/businessShow.html',
		controller: 'businessShowCtrl',
		resolve: {
			BusinessById: ["$stateParams", "Business", function BusinessById($stateParams, Business) {
				return Business.searchById($stateParams.yelpId);
			}],
			BusinessFavorites: ["$stateParams", "Business", function BusinessFavorites($stateParams, Business) {
				return Business.countFavorites($stateParams.yelpId);
			}]
		}
	});

	$urlRouterProvider.otherwise('/');
}])
// create a new filter -- titlecase filter
// everytime a value changes that uses this filter, this function will get triggered
// and it'll also trigger right away upon initial page load
.filter('titlecase', function () {
	// give it the standard dependency-injecting function
	// return the filter function
	return function (inputStr) {
		if (typeof inputStr !== 'string' || !inputStr.length) return;
		console.log('inputStr:', inputStr);

		// return the updated string
		return inputStr.toLowerCase().split(' ').map(function (word) {
			return word[0].toUpperCase() + word.slice(1);
		}).join(' ');
	};
}).filter('total', function () {
	// potentially useful for updating totals; alternative to $scope.$watch
	return function (nums) {
		// given input array
		return nums.reduce(function (sum, num) {
			return sum + num;
		}, 0); // get sum
	};
});
'use strict';

angular.module('myApp').controller('businessShowCtrl', ["$scope", "Business", "BusinessById", "BusinessFavorites", function ($scope, Business, BusinessById, BusinessFavorites) {
	console.log('businessShowCtrl');
	$scope.business = BusinessById;
	$scope.numOfFavorites = BusinessFavorites;
	console.log('$scope.business:', $scope.business);
}]);
'use strict';

angular.module('myApp').controller('loginCtrl', ["$scope", "$state", "$auth", function ($scope, $state, $auth) {
	console.log('loginCtrl!');

	$scope.login = function () {
		$auth.login($scope.user).then(function (res) {
			console.log('res:', res);
			$state.go('profile');
		}).catch(function (err) {
			console.log('err:', err);
		});
	};
}]);
'use strict';

angular.module('myApp').controller('mainCtrl', ["$scope", "$auth", "$state", "$rootScope", function ($scope, $auth, $state, $rootScope) {
	console.log('mainCtrl!');

	$scope.headerController = function ($scope, $location) {
		$scope.isActive = function (viewLocation) {
			return viewLocation === $location.path();
		};
	};

	// find out whether user is authenticated/logged in
	$scope.isAuthenticated = function () {
		return $auth.isAuthenticated();
	};

	this.author = 'sonam kindy'; // example of using titlecase filter in module.js

	$scope.authenticate = function (provider) {
		// provider is string we pass in, like 'facebook'
		$auth.authenticate(provider).then(function (res) {
			$state.go('profile');
			console.log('res:', res);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	$scope.logout = function () {
		$auth.logout();
		$state.go('home');
		$rootScope.currentUser = null;
	};
}]);
'use strict';

angular.module('myApp').controller('profileCtrl', ["$rootScope", "$scope", "User", "Profile", "Business", function ($rootScope, $scope, User, Profile, Business) {
	console.log('profileCtrl');

	$scope.myProfile = false;
	$rootScope.currentUser = Profile;
	console.log('$rootScope.currentUser:', $rootScope.currentUser);

	$scope.deleteFavorite = function (business) {
		Business.deleteFavorite(business).then(function (res) {
			$rootScope.currentUser = res;
		}).catch(function (err) {
			console.log('err:', err);
		});
	};
}]);
'use strict';

angular.module('myApp').controller('registerCtrl', ["$scope", "$state", "$auth", function ($scope, $state, $auth) {
	console.log('registerCtrl!');

	$scope.register = function () {
		if ($scope.user.password !== $scope.user.password2) {
			$scope.user.password = null;
			$scope.user.password2 = null;
			alert('Passwords must match.  Try again.');
		} else {

			$auth.signup($scope.user).then(function (res) {
				console.log('res:', res);
				$state.go('login');
			}).catch(function (err) {
				console.log('err:', err);
			});
		}
	};
}]);
'use strict';

angular.module('myApp').controller('searchCtrl', ["$scope", "Business", "$rootScope", function ($scope, Business, $rootScope) {
	console.log('searchCtrl');

	$scope.submit = function () {
		console.log('submit');
		Business.search($scope.params).then(function (res) {
			console.log('res:', res);
			$scope.businesses = res;
			$scope.params = null;
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	$scope.addFavorite = function (business) {
		console.log('business:', business);
		Business.addFavorite(business).then(function (res) {
			console.log('res:', res);
			$rootScope.currentUser = res;
		}).catch(function (err) {
			console.log('err:', err);
		});
	};
}]);
'use strict';

angular.module('myApp').service('Business', ["$http", "$state", "$q", function ($http, $state, $q) {

	// /search
	this.search = function (params) {
		return $http.get('/api/businesses/search/' + params.term + '/' + params.loc).then(function (res) {
			return $q.resolve(res.data.businesses);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	// single business view
	this.searchById = function (id) {
		return $http.get('/api/businesses/searchById/' + id).then(function (res) {
			return $q.resolve(res.data);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	// number of favorites business has
	this.countFavorites = function (id) {
		return $http.get('/api/businesses/countFavorites/' + id).then(function (res) {
			return $q.resolve(res.data);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	// user add favorite
	this.addFavorite = function (business) {
		return $http.post('/api/businesses/addFavorite/' + business.id, business).then(function (res) {
			return $q.resolve(res.data);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};

	// user delete favorite
	this.deleteFavorite = function (business) {
		console.log('business:', business);
		return $http.delete('/api/businesses/deleteFavorite/' + business.yelpId).then(function (res) {
			return $q.resolve(res.data);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};
}]);
'use strict';

angular.module('myApp').service('User', ["$http", "$rootScope", "$state", "$q", function ($http, $rootScope, $state, $q) {

	// this.getAll = () => {
	// 	return $http.get('/api/users')
	// 		.then(res => {
	// 			return $q.resolve(res.data);
	// 		})
	// 		.catch(err => {
	// 			console.log('err:', err);
	// 		})
	// }

	this.update = function (id, profile) {
		return $http.put('/api/users/profile/update/' + id, profile);
	};

	this.getProfile = function () {
		return $http.get('/api/users/profile').then(function (res) {
			return $q.resolve(res.data);
		}).catch(function (err) {
			console.log('err:', err);
		});
	};
}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1vZHVsZS5qcyIsImNvbnRyb2xsZXJzL2J1c2luZXNzU2hvdy5qcyIsImNvbnRyb2xsZXJzL2xvZ2luQ3RybC5qcyIsImNvbnRyb2xsZXJzL21haW5DdHJsLmpzIiwiY29udHJvbGxlcnMvcHJvZmlsZUN0cmwuanMiLCJjb250cm9sbGVycy9yZWdpc3RlckN0cmwuanMiLCJjb250cm9sbGVycy9zZWFyY2hDdHJsLmpzIiwic2VydmljZXMvYnVzaW5lc3NTZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlclNlcnZpY2UuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsUUFBUSxPQUFPLFNBQVMsQ0FBQyxhQUFhLGNBQWMsaUJBQ2xELHlCQUFPLFVBQVMsZUFBZTs7Q0FFL0IsY0FBYyxXQUFXO0NBQ3pCLGNBQWMsWUFBWTs7OztDQUkxQixjQUFjLFNBQVM7RUFDdEIsVUFBVTtFQUNWLEtBQUs7O0lBSU4sZ0RBQU8sVUFBUyxnQkFBZ0Isb0JBQW9CO0NBQ3BELGVBQ0UsTUFBTSxRQUFRLEVBQUUsS0FBSyxLQUFLLGFBQWEscUJBQ3ZDLE1BQU0sU0FBUztFQUNmLEtBQUs7RUFDTCxhQUFhO0VBQ2IsWUFBWTtJQUVaLE1BQU0sWUFBWTtFQUNsQixLQUFLO0VBQ0wsYUFBYTtFQUNiLFlBQVk7SUFFWixNQUFNLFdBQVc7RUFDakIsS0FBSztFQUNMLGFBQWE7RUFDYixZQUFZO0VBQ1osU0FBUztHQUNSLGtCQUFTLFNBQUEsUUFBUyxNQUFNO0lBQ3ZCLE9BQU8sS0FBSzs7O0lBSWQsTUFBTSxVQUFVO0VBQ2hCLEtBQUs7RUFDTCxhQUFhO0VBQ2IsWUFBWTtJQUVaLE1BQU0sZ0JBQWdCO0VBQ3RCLEtBQUs7RUFDTCxhQUFhO0VBQ2IsWUFBWTtFQUNaLFNBQVM7R0FDUiwyQ0FBYyxTQUFBLGFBQVMsY0FBYyxVQUFVO0lBQzlDLE9BQU8sU0FBUyxXQUFXLGFBQWE7O0dBRXpDLGdEQUFtQixTQUFBLGtCQUFTLGNBQWMsVUFBVTtJQUNuRCxPQUFPLFNBQVMs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QUEsVUFBWTtFQUM5QixPQUFPLE1BQU0sS0FBTixpQ0FBMEMsU0FBUyxJQUFNLFVBQzlELEtBQUssVUFBQSxLQUFPO0dBQ1osT0FBTyxHQUFHLFFBQVEsSUFBSTtLQUV0QixNQUFNLFVBQUEsS0FBTztHQUNiLFFBQVEsSUFBSSxRQUFROzs7OztDQUt2QixLQUFLLGlCQUFpQixVQUFBLFVBQVk7RUFDakMsUUFBUSxJQUFJLGFBQWE7RUFDekIsT0FBTyxNQUFNLE9BQU4sb0NBQStDLFNBQVMsUUFDN0QsS0FBSyxVQUFBLEtBQU87R0FDWixPQUFPLEdBQUcsUUFBUSxJQUFJO0tBRXRCLE1BQU0sVUFBQSxLQUFPO0dBQ2IsUUFBUSxJQUFJLFFBQVE7OztJQXREeEI7QUNGQTs7QUFFQSxRQUFRLE9BQU8sU0FBUyxRQUFRLGdEQUFRLFVBQVMsT0FBTyxZQUFZLFFBQVEsSUFBSTs7Ozs7Ozs7Ozs7O0NBWS9FLEtBQUssU0FBUyxVQUFDLElBQUksU0FBWTtFQUM5QixPQUFPLE1BQU0sSUFBTiwrQkFBdUMsSUFBTTs7O0NBR3JELEtBQUssYUFBYSxZQUFNO0VBQ3ZCLE9BQU8sTUFBTSxJQUFJLHNCQUNmLEtBQUssVUFBQSxLQUFPO0dBQ1osT0FBTyxHQUFHLFFBQVEsSUFBSTtLQUV0QixNQUFNLFVBQUEsS0FBTztHQUNiLFFBQVEsSUFBSSxRQUFROzs7SUF0QnhCIiwiZmlsZSI6ImJ1bmRsZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ215QXBwJywgWyd1aS5yb3V0ZXInLCAnc2F0ZWxsaXplcicsICduZ0ZpbGVVcGxvYWQnXSlcblx0LmNvbmZpZyhmdW5jdGlvbigkYXV0aFByb3ZpZGVyKSB7XG5cblx0XHQkYXV0aFByb3ZpZGVyLmxvZ2luVXJsID0gJy9hcGkvdXNlcnMvbG9naW4nO1xuXHRcdCRhdXRoUHJvdmlkZXIuc2lnbnVwVXJsID0gJy9hcGkvdXNlcnMvc2lnbnVwJztcblxuXHRcdC8vIGNvbmZpZ3VyZSBzYXRlbGxpemVyIGJ5IGdpdmluZyBpdCB0aGUgcHJvdmlkZXIgYXBwIElEXG5cdFx0Ly8gc3BlY2lmeSB0aGUgdXJsIHRvIG1ha2UgYSBwb3N0IHJlcXVlc3QgdG8gd2hlbiB0aGUgdG9rZW4gaXMgZ2VuZXJhdGVkIGJ5IHNhdGVsbGl6ZXJcblx0XHQkYXV0aFByb3ZpZGVyLmZhY2Vib29rKHtcblx0XHRcdGNsaWVudElkOiAnMTE1MzA4MjgwMTQyMDgzMScsXG5cdFx0XHR1cmw6ICcvYXBpL3VzZXJzL2ZhY2Vib29rJ1xuXHRcdH0pO1xuXG5cdH0pXG5cdC5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXHRcdCRzdGF0ZVByb3ZpZGVyXG5cdFx0XHQuc3RhdGUoJ2hvbWUnLCB7IHVybDogJy8nLCB0ZW1wbGF0ZVVybDogJy9odG1sL2hvbWUuaHRtbCcgfSlcblx0XHRcdC5zdGF0ZSgnbG9naW4nLCB7XG5cdFx0XHRcdHVybDogJy9sb2dpbicsXG5cdFx0XHRcdHRlbXBsYXRlVXJsOiAnL2h0bWwvbG9naW4uaHRtbCcsXG5cdFx0XHRcdGNvbnRyb2xsZXI6ICdsb2dpbkN0cmwnXG5cdFx0XHR9KVxuXHRcdFx0LnN0YXRlKCdyZWdpc3RlcicsIHtcblx0XHRcdFx0dXJsOiAnL3JlZ2lzdGVyJyxcblx0XHRcdFx0dGVtcGxhdGVVcmw6ICcvaHRtbC9yZWdpc3Rlci5odG1sJyxcblx0XHRcdFx0Y29udHJvbGxlcjogJ3JlZ2lzdGVyQ3RybCdcblx0XHRcdH0pXG5cdFx0XHQuc3RhdGUoJ3Byb2ZpbGUnLCB7XG5cdFx0XHRcdHVybDogJy9wcm9maWxlJyxcblx0XHRcdFx0dGVtcGxhdGVVcmw6ICcvaHRtbC9wcm9maWxlLmh0bWwnLFxuXHRcdFx0XHRjb250cm9sbGVyOiAncHJvZmlsZUN0cmwnLFxuXHRcdFx0XHRyZXNvbHZlOiB7XG5cdFx0XHRcdFx0UHJvZmlsZTogZnVuY3Rpb24oVXNlcikge1xuXHRcdFx0XHRcdFx0cmV0dXJuIFVzZXIuZ2V0UHJvZmlsZSgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSlcblx0XHRcdC5zdGF0ZSgnc2VhcmNoJywge1xuXHRcdFx0XHR1cmw6ICcvc2VhcmNoJyxcblx0XHRcdFx0dGVtcGxhdGVVcmw6ICcvaHRtbC9zZWFyY2guaHRtbCcsXG5cdFx0XHRcdGNvbnRyb2xsZXI6ICdzZWFyY2hDdHJsJ1xuXHRcdFx0fSlcblx0XHRcdC5zdGF0ZSgnYnVzaW5lc3NTaG93Jywge1xuXHRcdFx0XHR1cmw6ICcvYnVzaW5lc3NTaG93Lzp5ZWxwSWQnLFxuXHRcdFx0XHR0ZW1wbGF0ZVVybDogJy9odG1sL2J1c2luZXNzU2hvdy5odG1sJyxcblx0XHRcdFx0Y29udHJvbGxlcjogJ2J1c2luZXNzU2hvd0N0cmwnLFxuXHRcdFx0XHRyZXNvbHZlOiB7XG5cdFx0XHRcdFx0QnVzaW5lc3NCeUlkOiBmdW5jdGlvbigkc3RhdGVQYXJhbXMsIEJ1c2luZXNzKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gQnVzaW5lc3Muc2VhcmNoQnlJZCgkc3RhdGVQYXJhbXMueWVscElkKTtcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdEJ1c2luZXNzRmF2b3JpdGVzOiBmdW5jdGlvbigkc3RhdGVQYXJhbXMsIEJ1c2luZXNzKSB7XG5cdFx0XHRcdFx0XHRyZXR1cm4gQnVzaW5lc3MuY291bnRGYXZvcml0ZXMoJHN0YXRlUGFyYW1zLnllbHBJZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KVxuXG5cdFx0JHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXHR9KVxuXHQvLyBjcmVhdGUgYSBuZXcgZmlsdGVyIC0tIHRpdGxlY2FzZSBmaWx0ZXJcblx0Ly8gZXZlcnl0aW1lIGEgdmFsdWUgY2hhbmdlcyB0aGF0IHVzZXMgdGhpcyBmaWx0ZXIsIHRoaXMgZnVuY3Rpb24gd2lsbCBnZXQgdHJpZ2dlcmVkXG5cdC8vIGFuZCBpdCdsbCBhbHNvIHRyaWdnZXIgcmlnaHQgYXdheSB1cG9uIGluaXRpYWwgcGFnZSBsb2FkXG5cdC5maWx0ZXIoJ3RpdGxlY2FzZScsIGZ1bmN0aW9uKCkgeyAvLyBnaXZlIGl0IHRoZSBzdGFuZGFyZCBkZXBlbmRlbmN5LWluamVjdGluZyBmdW5jdGlvblxuXHRcdC8vIHJldHVybiB0aGUgZmlsdGVyIGZ1bmN0aW9uXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKGlucHV0U3RyKSB7XG5cdFx0XHRpZiAodHlwZW9mIGlucHV0U3RyICE9PSAnc3RyaW5nJyB8fCAhaW5wdXRTdHIubGVuZ3RoKSByZXR1cm47XG5cdFx0XHRjb25zb2xlLmxvZygnaW5wdXRTdHI6JywgaW5wdXRTdHIpO1xuXG5cdFx0XHQvLyByZXR1cm4gdGhlIHVwZGF0ZWQgc3RyaW5nXG5cdFx0XHRyZXR1cm4gaW5wdXRTdHIudG9Mb3dlckNhc2UoKVxuXHRcdFx0XHQuc3BsaXQoJyAnKVxuXHRcdFx0XHQubWFwKHdvcmQgPT4gd29yZFswXS50b1VwcGVyQ2FzZSgpICsgd29yZC5zbGljZSgxKSlcblx0XHRcdFx0LmpvaW4oJyAnKTtcblx0XHR9XG5cdH0pXG5cdC5maWx0ZXIoJ3RvdGFsJywgZnVuY3Rpb24oKSB7IC8vIHBvdGVudGlhbGx5IHVzZWZ1bCBmb3IgdXBkYXRpbmcgdG90YWxzOyBhbHRlcm5hdGl2ZSB0byAkc2NvcGUuJHdhdGNoXG5cdFx0cmV0dXJuIGZ1bmN0aW9uKG51bXMpIHsgLy8gZ2l2ZW4gaW5wdXQgYXJyYXlcblx0XHRcdHJldHVybiBudW1zLnJlZHVjZSgoc3VtLCBudW0pID0+IHN1bSArIG51bSwgMCk7IC8vIGdldCBzdW1cblx0XHR9XG5cdH0pXG4iLCIndXNlIHN0cmljdCc7XG5cbmFuZ3VsYXIubW9kdWxlKCdteUFwcCcpLmNvbnRyb2xsZXIoJ2J1c2luZXNzU2hvd0N0cmwnLCBmdW5jdGlvbigkc2NvcGUsIEJ1c2luZXNzLCBCdXNpbmVzc0J5SWQsIEJ1c2luZXNzRmF2b3JpdGVzKSB7XG5cdGNvbnNvbGUubG9nKCdidXNpbmVzc1Nob3dDdHJsJyk7XG5cdCRzY29wZS5idXNpbmVzcyA9IEJ1c2luZXNzQnlJZDtcblx0JHNjb3BlLm51bU9mRmF2b3JpdGVzID0gQnVzaW5lc3NGYXZvcml0ZXM7XG5cdGNvbnNvbGUubG9nKCckc2NvcGUuYnVzaW5lc3M6JywgJHNjb3BlLmJ1c2luZXNzKTtcbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbXlBcHAnKS5jb250cm9sbGVyKCdsb2dpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJGF1dGgpIHtcblx0Y29uc29sZS5sb2coJ2xvZ2luQ3RybCEnKTtcblxuXHQkc2NvcGUubG9naW4gPSAoKSA9PiB7XG5cdFx0JGF1dGgubG9naW4oJHNjb3BlLnVzZXIpXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygncmVzOicsIHJlcyk7XG5cdFx0XHRcdCRzdGF0ZS5nbygncHJvZmlsZScpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KTtcblx0fTtcblxufSlcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ215QXBwJykuY29udHJvbGxlcignbWFpbkN0cmwnLCBmdW5jdGlvbigkc2NvcGUsICRhdXRoLCAkc3RhdGUsICRyb290U2NvcGUpIHtcblx0Y29uc29sZS5sb2coJ21haW5DdHJsIScpO1xuXG5cdCRzY29wZS5oZWFkZXJDb250cm9sbGVyID0gZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24pIHtcblx0XHQkc2NvcGUuaXNBY3RpdmUgPSBmdW5jdGlvbih2aWV3TG9jYXRpb24pIHtcblx0XHRcdHJldHVybiB2aWV3TG9jYXRpb24gPT09ICRsb2NhdGlvbi5wYXRoKCk7XG5cdFx0fTtcblx0fTtcblxuXHQvLyBmaW5kIG91dCB3aGV0aGVyIHVzZXIgaXMgYXV0aGVudGljYXRlZC9sb2dnZWQgaW5cblx0JHNjb3BlLmlzQXV0aGVudGljYXRlZCA9ICgpID0+ICRhdXRoLmlzQXV0aGVudGljYXRlZCgpO1xuXG5cdHRoaXMuYXV0aG9yID0gJ3NvbmFtIGtpbmR5JzsgLy8gZXhhbXBsZSBvZiB1c2luZyB0aXRsZWNhc2UgZmlsdGVyIGluIG1vZHVsZS5qc1xuXG5cdCRzY29wZS5hdXRoZW50aWNhdGUgPSBwcm92aWRlciA9PiB7IC8vIHByb3ZpZGVyIGlzIHN0cmluZyB3ZSBwYXNzIGluLCBsaWtlICdmYWNlYm9vaydcblx0XHQkYXV0aC5hdXRoZW50aWNhdGUocHJvdmlkZXIpXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHQkc3RhdGUuZ28oJ3Byb2ZpbGUnKTtcblx0XHRcdFx0Y29uc29sZS5sb2coJ3JlczonLCByZXMpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KVxuXHR9XG5cblx0JHNjb3BlLmxvZ291dCA9ICgpID0+IHtcblx0XHQkYXV0aC5sb2dvdXQoKTtcblx0XHQkc3RhdGUuZ28oJ2hvbWUnKTtcblx0XHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gbnVsbDtcblx0fVxuXG59KVxuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbXlBcHAnKS5jb250cm9sbGVyKCdwcm9maWxlQ3RybCcsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRzY29wZSwgVXNlciwgUHJvZmlsZSwgQnVzaW5lc3MpIHtcblx0Y29uc29sZS5sb2coJ3Byb2ZpbGVDdHJsJyk7XG5cblx0JHNjb3BlLm15UHJvZmlsZSA9IGZhbHNlO1xuXHQkcm9vdFNjb3BlLmN1cnJlbnRVc2VyID0gUHJvZmlsZTtcblx0Y29uc29sZS5sb2coJyRyb290U2NvcGUuY3VycmVudFVzZXI6JywgJHJvb3RTY29wZS5jdXJyZW50VXNlcik7XG5cblx0JHNjb3BlLmRlbGV0ZUZhdm9yaXRlID0gYnVzaW5lc3MgPT4ge1xuXHRcdEJ1c2luZXNzLmRlbGV0ZUZhdm9yaXRlKGJ1c2luZXNzKVxuXHRcdFx0LnRoZW4ocmVzID0+IHtcblx0XHRcdFx0JHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHJlcztcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuXHRcdFx0fSlcblx0fVxuXG59KVxuIiwiYW5ndWxhci5tb2R1bGUoJ215QXBwJykuY29udHJvbGxlcigncmVnaXN0ZXJDdHJsJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRhdXRoKSB7XG5cdGNvbnNvbGUubG9nKCdyZWdpc3RlckN0cmwhJyk7XG5cblx0JHNjb3BlLnJlZ2lzdGVyID0gKCkgPT4ge1xuXHRcdGlmICgkc2NvcGUudXNlci5wYXNzd29yZCAhPT0gJHNjb3BlLnVzZXIucGFzc3dvcmQyKSB7XG5cdFx0XHQkc2NvcGUudXNlci5wYXNzd29yZCA9IG51bGw7XG5cdFx0XHQkc2NvcGUudXNlci5wYXNzd29yZDIgPSBudWxsO1xuXHRcdFx0YWxlcnQoJ1Bhc3N3b3JkcyBtdXN0IG1hdGNoLiAgVHJ5IGFnYWluLicpO1xuXHRcdH0gZWxzZSB7XG5cblx0XHRcdCRhdXRoLnNpZ251cCgkc2NvcGUudXNlcilcblx0XHRcdFx0LnRoZW4ocmVzID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygncmVzOicsIHJlcyk7XG5cdFx0XHRcdFx0JHN0YXRlLmdvKCdsb2dpbicpO1xuXHRcdFx0XHR9KVxuXHRcdFx0XHQuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdH1cblx0fTtcblxufSlcbiIsIid1c2Ugc3RyaWN0JztcblxuYW5ndWxhci5tb2R1bGUoJ215QXBwJykuY29udHJvbGxlcignc2VhcmNoQ3RybCcsIGZ1bmN0aW9uKCRzY29wZSwgQnVzaW5lc3MsICRyb290U2NvcGUpIHtcblx0Y29uc29sZS5sb2coJ3NlYXJjaEN0cmwnKTtcblxuXHQkc2NvcGUuc3VibWl0ID0gKCkgPT4ge1xuXHRcdGNvbnNvbGUubG9nKCdzdWJtaXQnKTtcblx0XHRCdXNpbmVzcy5zZWFyY2goJHNjb3BlLnBhcmFtcylcblx0XHRcdC50aGVuKHJlcyA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdyZXM6JywgcmVzKTtcblx0XHRcdFx0JHNjb3BlLmJ1c2luZXNzZXMgPSByZXM7XG5cdFx0XHRcdCRzY29wZS5wYXJhbXMgPSBudWxsO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KTtcblx0fTtcblxuXHQkc2NvcGUuYWRkRmF2b3JpdGUgPSBidXNpbmVzcyA9PiB7XG5cdFx0Y29uc29sZS5sb2coJ2J1c2luZXNzOicsIGJ1c2luZXNzKTtcblx0XHRCdXNpbmVzcy5hZGRGYXZvcml0ZShidXNpbmVzcylcblx0XHRcdC50aGVuKHJlcyA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdyZXM6JywgcmVzKTtcblx0XHRcdFx0JHJvb3RTY29wZS5jdXJyZW50VXNlciA9IHJlcztcblx0XHRcdH0pXG5cdFx0XHQuY2F0Y2goZXJyID0+IHtcblx0XHRcdFx0Y29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuXHRcdFx0fSk7XG5cdH07XG5cbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbXlBcHAnKS5zZXJ2aWNlKCdCdXNpbmVzcycsIGZ1bmN0aW9uKCRodHRwLCAkc3RhdGUsICRxKSB7XG5cblx0Ly8gL3NlYXJjaFxuXHR0aGlzLnNlYXJjaCA9IHBhcmFtcyA9PiB7XG5cdFx0cmV0dXJuICRodHRwLmdldChgL2FwaS9idXNpbmVzc2VzL3NlYXJjaC8ke3BhcmFtcy50ZXJtfS8ke3BhcmFtcy5sb2N9YClcblx0XHRcdC50aGVuKHJlcyA9PiB7XG5cdFx0XHRcdHJldHVybiAkcS5yZXNvbHZlKHJlcy5kYXRhLmJ1c2luZXNzZXMpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KTtcblx0fTtcblxuXHQvLyBzaW5nbGUgYnVzaW5lc3Mgdmlld1xuXHR0aGlzLnNlYXJjaEJ5SWQgPSBpZCA9PiB7XG5cdFx0cmV0dXJuICRodHRwLmdldChgL2FwaS9idXNpbmVzc2VzL3NlYXJjaEJ5SWQvJHtpZH1gKVxuXHRcdFx0LnRoZW4ocmVzID0+IHtcblx0XHRcdFx0cmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KTtcblx0fTtcblxuXHQvLyBudW1iZXIgb2YgZmF2b3JpdGVzIGJ1c2luZXNzIGhhc1xuXHR0aGlzLmNvdW50RmF2b3JpdGVzID0gaWQgPT4ge1xuXHRcdHJldHVybiAkaHR0cC5nZXQoYC9hcGkvYnVzaW5lc3Nlcy9jb3VudEZhdm9yaXRlcy8ke2lkfWApXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHRyZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGVyciA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcblx0XHRcdH0pO1xuXHR9O1xuXG5cdC8vIHVzZXIgYWRkIGZhdm9yaXRlXG5cdHRoaXMuYWRkRmF2b3JpdGUgPSBidXNpbmVzcyA9PiB7XG5cdFx0cmV0dXJuICRodHRwLnBvc3QoYC9hcGkvYnVzaW5lc3Nlcy9hZGRGYXZvcml0ZS8ke2J1c2luZXNzLmlkfWAsIGJ1c2luZXNzKVxuXHRcdFx0LnRoZW4ocmVzID0+IHtcblx0XHRcdFx0cmV0dXJuICRxLnJlc29sdmUocmVzLmRhdGEpO1xuXHRcdFx0fSlcblx0XHRcdC5jYXRjaChlcnIgPT4ge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnZXJyOicsIGVycik7XG5cdFx0XHR9KTtcblx0fTtcblxuXHQvLyB1c2VyIGRlbGV0ZSBmYXZvcml0ZVxuXHR0aGlzLmRlbGV0ZUZhdm9yaXRlID0gYnVzaW5lc3MgPT4ge1xuXHRcdGNvbnNvbGUubG9nKCdidXNpbmVzczonLCBidXNpbmVzcyk7XG5cdFx0cmV0dXJuICRodHRwLmRlbGV0ZShgL2FwaS9idXNpbmVzc2VzL2RlbGV0ZUZhdm9yaXRlLyR7YnVzaW5lc3MueWVscElkfWApXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHRyZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGVyciA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcblx0XHRcdH0pO1xuXHR9O1xuXG5cbn0pO1xuIiwiJ3VzZSBzdHJpY3QnO1xuXG5hbmd1bGFyLm1vZHVsZSgnbXlBcHAnKS5zZXJ2aWNlKCdVc2VyJywgZnVuY3Rpb24oJGh0dHAsICRyb290U2NvcGUsICRzdGF0ZSwgJHEpIHtcblxuXHQvLyB0aGlzLmdldEFsbCA9ICgpID0+IHtcblx0Ly8gXHRyZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3VzZXJzJylcblx0Ly8gXHRcdC50aGVuKHJlcyA9PiB7XG5cdC8vIFx0XHRcdHJldHVybiAkcS5yZXNvbHZlKHJlcy5kYXRhKTtcblx0Ly8gXHRcdH0pXG5cdC8vIFx0XHQuY2F0Y2goZXJyID0+IHtcblx0Ly8gXHRcdFx0Y29uc29sZS5sb2coJ2VycjonLCBlcnIpO1xuXHQvLyBcdFx0fSlcblx0Ly8gfVxuXG5cdHRoaXMudXBkYXRlID0gKGlkLCBwcm9maWxlKSA9PiB7XG5cdFx0cmV0dXJuICRodHRwLnB1dChgL2FwaS91c2Vycy9wcm9maWxlL3VwZGF0ZS8ke2lkfWAsIHByb2ZpbGUpO1xuXHR9XG5cblx0dGhpcy5nZXRQcm9maWxlID0gKCkgPT4ge1xuXHRcdHJldHVybiAkaHR0cC5nZXQoJy9hcGkvdXNlcnMvcHJvZmlsZScpXG5cdFx0XHQudGhlbihyZXMgPT4ge1xuXHRcdFx0XHRyZXR1cm4gJHEucmVzb2x2ZShyZXMuZGF0YSk7XG5cdFx0XHR9KVxuXHRcdFx0LmNhdGNoKGVyciA9PiB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdlcnI6JywgZXJyKTtcblx0XHRcdH0pXG5cdH1cblxufSlcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
